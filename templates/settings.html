<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - SMS Suite</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="header">
        <h1>Settings</h1>
        <p><a href="{{ url_for('index') }}">Back to Messaging</a></p>
    </div>
    <div class="main-container settings-container">
        <div class="settings-section">
            <h2>Google Account</h2>
            <p><strong>Connected Email:</strong> {{ email }}</p>
        </div>

        <div class="settings-section">
            <h2>Twilio Credentials</h2>
            <form id="twilio-settings-form">
                <div class="form-group">
                    <label for="account_sid">Account SID:</label>
                    <input type="text" id="account_sid" name="account_sid" value="{{ twilio_account_sid if twilio_account_sid else '' }}" required>
                </div>
                <div class="form-group">
                    <label for="auth_token">Auth Token:</label>
                    <input type="text" id="auth_token" name="auth_token" value="{{ twilio_auth_token if twilio_auth_token else '' }}" required>
                </div>
                <div class="form-group">
                    <label for="phone_number">Twilio Phone Number (E.164 format, e.g., +12345678900):</label>
                    <input type="text" id="phone_number" name="phone_number" value="{{ twilio_phone_number if twilio_phone_number else '' }}" required>
                </div>
                <button type="submit">Save Twilio Settings</button>
                <p id="twilio-feedback" class="feedback-message"></p>
            </form>
        </div>

        <div class="settings-section">
            <h2>Import Data</h2>
            <p>Import your historical SMS conversations from Twilio. This may take a while depending on the number of messages.</p>
            <button id="import-twilio-history-btn">Import Twilio History</button>
            <p id="import-history-feedback" class="feedback-message"></p>
        </div>

        <div class="settings-section">
            <h2>Apply Names From Sheet</h2>
            <p>Paste JSON array like: [{"name":"Alice","phone_number":"(555) 123-4567"}, ...] or use a minimal CSV (phone,name).</p>
            <textarea id="sheet-contacts-input" rows="6" placeholder='[{"name":"Alice","phone_number":"(555) 123-4567"}]'></textarea>
            <div style="margin-top:8px;">
                <button id="apply-sheet-contacts-btn">Apply Names</button>
            </div>
            <p id="apply-sheet-contacts-feedback" class="feedback-message"></p>
        </div>

        <div class="settings-section">
            <h2>Maintenance</h2>
            <p>Recalculate conversation ordering from message history if the list looks out of order.</p>
            <button id="recalc-last-activity-btn">Recalculate Conversation Order</button>
            <p id="recalc-feedback" class="feedback-message"></p>
        </div>
    </div>

    <script src="{{ url_for('static', filename='settings.js') }}"></script>
</body>
</html>
